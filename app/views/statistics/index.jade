extends ../layout

block content
  .page-header
    h1 Application Statistics

  //- .lead Filter will be here

  canvas#memory_usage(width="1000" height="400")

  script.
    var charts = {};

    console.log(Chart)
    Chart.defaults.global.responsive = true;

    charts.memory_usage = {};

    charts.memory_usage.canvas_ctx = document.getElementById("memory_usage").getContext("2d");
    charts.memory_usage.root = new Chart(charts.memory_usage.canvas_ctx);

    charts.memory_usage.data = {
      labels: _.range(#{stats.opts.count}),
      datasets: [
        {
          label: "My First dataset",
          fillColor: "rgba(220,220,220,0.2)",
          strokeColor: "rgba(220,220,220,1)",
          pointColor: "rgba(220,220,220,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(220,220,220,1)",
          data: [#{stats.data.__memory}]
        },
        {
          label: "My Second dataset",
          fillColor: "rgba(151,187,205,0.2)",
          strokeColor: "rgba(151,187,205,1)",
          pointColor: "rgba(151,187,205,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(151,187,205,1)",
          data: [#{stats.data.__loaded}]
        }
      ]
    };

    charts.memory_usage.options = {};

    charts.memory_usage.chart = charts.memory_usage.root.Line(charts.memory_usage.data, charts.memory_usage.options);

    socket = io.connect('http://localhost:3535/memory_usage');

    socket.on('update', function(data) {
      _.forEach(charts.memory_usage.chart.datasets[0].points, function(point, index) {
        charts.memory_usage.chart.datasets[0].points[index].value = data.stats.data.__memory[index];
      });
      _.forEach(charts.memory_usage.chart.datasets[1].points, function(point, index) {
        charts.memory_usage.chart.datasets[1].points[index].value = data.stats.data.__loaded[index];
      });
      charts.memory_usage.chart.update();
    });
